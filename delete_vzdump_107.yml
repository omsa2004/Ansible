---
- name: Delete vzdump-qemu-107* backups on host2
  hosts: host2
  gather_facts: false
  become: true

  vars:
    dump_dir: "/var/lib/vz/dump"
    pattern: "vzdump-qemu-107*"

  tasks:
    - name: Quick list matching files (does not recurse)
      ansible.builtin.shell: |
        set -o pipefail
        ls -1 {{ dump_dir }}/{{ pattern }} 2>/dev/null || true
      args:
        executable: /bin/bash
      register: files
      changed_when: false

    - name: Show what will be deleted
      ansible.builtin.debug:
        var: files.stdout_lines

    - name: Delete matching files quickly
      ansible.builtin.shell: |
        shopt -s nullglob
        rm -f -- {{ dump_dir }}/{{ pattern }}
      args:
        executable: /bin/bash
      register: rm_result
      changed_when: files.stdout | length > 0
