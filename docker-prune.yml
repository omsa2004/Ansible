---
- name: Docker prune on hosts
  hosts: all
  become: true
  gather_facts: false

  tasks:
    - name: Show docker disk usage before
      command: docker system df
      register: before_df
      changed_when: false
      failed_when: false

    - name: Run docker system prune (safe)
      command: docker system prune -f
      register: prune_out

    - name: Show docker disk usage after
      command: docker system df
      register: after_df
      changed_when: false
      failed_when: false

    - name: Print results
      debug:
        msg:
          - "BEFORE:\n{{ before_df.stdout | default('') }}"
          - "PRUNE:\n{{ prune_out.stdout | default('') }}"
          - "AFTER:\n{{ after_df.stdout | default('') }}"
